<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crow Syndicate - PokeMMO Team</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            background-image: url('images/background-sky.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .discord-btn {
            background-color: #5865F2;
            transition: background-color 0.3s ease;
        }
        .discord-btn:hover {
            background-color: #4752C4;
        }
        .loader {
            border-top-color: #5865F2;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .circular-container {
            position: relative;
            width: 350px;
            height: 350px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .center-logo {
            width: 140px;
            height: 140px;
            background-color: rgba(31, 41, 55, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 4px solid #4b5563;
            z-index: 10;
        }
        
        .center-logo img {
            width: 100px;
            height: 100px;
        }

        .icon-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(calc(360deg / 8 * var(--i)));
        }

        .icon-item a {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(0deg) translateY(-175px); /* Changed rotation to 0 */
            width: 60px;
            height: 60px;
            background: #2b3748;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #9ca3af;
            font-size: 1.5rem;
            border: 2px solid #4b5563;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .icon-item a .fa-solid {
             transform: rotate(calc(-360deg / 8 * var(--i))); /* Keep icon upright */
             transition: transform 0.3s ease;
        }

        .icon-item a:hover {
            background-color: #5865F2;
            color: #fff;
            border-color: #5865F2;
            box-shadow: 0 0 15px #5865F2;
        }
        
        .icon-item a:hover .fa-solid {
            transform: rotate(calc(-360deg / 8 * var(--i))) scale(1.2);
        }
        
        #flying-crows-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .flying-crow {
            position: absolute;
            width: 200px;
            height: 176px;
            animation-name: fly-across;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            animation-fill-mode: backwards;
            opacity: 0;
        }

        @keyframes fly-across {
            0% {
                transform: translateX(100vw);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            95% {
                opacity: 1;
            }
            100% {
                transform: translateX(-200px);
                opacity: 0;
            }
        }

    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div id="flying-crows-container"></div>

    <div id="app" class="w-full max-w-5xl mx-auto" style="position: relative; z-index: 5;">
        
        <!-- Loading State -->
        <div id="loading" class="text-center">
             <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4 mx-auto"></div>
             <p class="text-lg text-gray-400">Loading your PokeMMO Hub...</p>
        </div>
        
        <!-- Landing Page View -->
        <div id="landing-view" class="hidden flex-col items-center text-center">
             <div class="circular-container mb-12">
                <div class="center-logo">
                    <img src="images/crow.png" alt="Crow Syndicate Logo">
                </div>
                <!-- Icons will be positioned around the logo -->
                <div class="icon-item" style="--i: 0;"><a data-page="shiny-dex" data-tooltip="Shiny Dex"><i class="fa-solid fa-wand-magic-sparkles"></i></a></div>
                <div class="icon-item" style="--i: 1;"><a data-page="about-us" data-tooltip="About Us"><i class="fa-solid fa-circle-info"></i></a></div>
                <div class="icon-item" style="--i: 2;"><a data-page="members" data-tooltip="Members"><i class="fa-solid fa-users"></i></a></div>
                <div class="icon-item" style="--i: 3;"><a data-page="recruitment" data-tooltip="Recruitment"><i class="fa-solid fa-user-plus"></i></a></div>
                <div class="icon-item" style="--i: 4;"><a data-page="shiny-hall" data-tooltip="Shiny Hall"><i class="fa-solid fa-star"></i></a></div>
                <div class="icon-item" style="--i: 5;"><a data-page="tournaments" data-tooltip="Tournaments"><i class="fa-solid fa-trophy"></i></a></div>
                <div class="icon-item" style="--i: 6;"><a data-page="bounties" data-tooltip="Bounties"><i class="fa-solid fa-crosshairs"></i></a></div>
                <div class="icon-item" style="--i: 7;"><a data-page="gallery" data-tooltip="Gallery"><i class="fa-solid fa-images"></i></a></div>
             </div>
             <h1 class="text-6xl font-bold mb-4 text-white drop-shadow-lg" style="text-shadow: 2px 2px 4px #000000;">Crow Syndicate</h1>
             <p class="text-gray-200 mb-8 max-w-md bg-black bg-opacity-50 p-2 rounded-md">A PokeMMO team focused on competitive play, community, and strategy. Log in to join the ranks.</p>
             
             <div id="auth-buttons">
                <!-- Login/Logout buttons will be injected here -->
             </div>
        </div>

        <!-- Members / Dashboard View -->
        <div id="dashboard-view" class="hidden w-full">
            <header class="flex flex-col sm:flex-row justify-between items-center mb-8 pb-4 border-b border-gray-700">
                <button class="back-btn text-gray-400 hover:text-white transition-colors mb-4 sm:mb-0"><i class="fa-solid fa-arrow-left mr-2"></i> Back to Home</button>
                <div id="user-profile" class="flex items-center">
                    <!-- User info will be injected here -->
                </div>
                <button id="logout-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                    Logout
                </button>
            </header>

            <main class="bg-gray-800 rounded-xl p-6 shadow-lg">
                <h2 id="team-name" class="text-3xl font-bold mb-6 text-center"></h2>
                <div id="team-members" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Team members will be injected here -->
                </div>
                <div id="join-team-container" class="text-center mt-8 hidden">
                     <p class="text-gray-400 mb-4">You are not yet a member of the syndicate.</p>
                     <button id="join-team-btn" class="discord-btn text-white font-bold py-3 px-6 rounded-lg text-lg">
                        Join Crow Syndicate
                     </button>
                </div>
            </main>
        </div>
        
        <!-- Generic Page View -->
        <div id="page-view" class="hidden w-full">
             <header class="flex justify-start items-center mb-8 pb-4 border-b border-gray-700">
                <button class="back-btn text-gray-400 hover:text-white transition-colors"><i class="fa-solid fa-arrow-left mr-2"></i> Back to Home</button>
             </header>
             <main class="bg-gray-800 rounded-xl p-8 shadow-lg text-center">
                <h2 id="page-title" class="text-4xl font-bold mb-6"></h2>
                <div id="page-content" class="text-gray-300">
                    <p>Content for this section is coming soon!</p>
                </div>
             </main>
        </div>

    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // --- ⚙️ CONFIGURATION - These will be replaced by GitHub Actions ---
        const firebaseConfig = {
            apiKey: "##FIREBASE_API_KEY##",
            authDomain: "##FIREBASE_AUTH_DOMAIN##",
            projectId: "##FIREBASE_PROJECT_ID##",
            storageBucket: "##FIREBASE_STORAGE_BUCKET##",
            messagingSenderId: "##FIREBASE_MESSAGING_SENDER_ID##",
            appId: "##FIREBASE_APP_ID##"
        };
        const DISCORD_CLIENT_ID = "##DISCORD_CLIENT_ID##"; 
        const TEAM_ID = "crow-syndicate"; // Hardcoded team ID for now
        // --- END CONFIGURATION ---

        // --- STATE ---
        let currentUser = null;
        let discordUser = null;

        // --- UI ELEMENTS ---
        const appViews = {
            loading: document.getElementById('loading'),
            landing: document.getElementById('landing-view'),
            dashboard: document.getElementById('dashboard-view'),
            page: document.getElementById('page-view')
        };
        
        const authButtonsContainer = document.getElementById('auth-buttons');
        const userProfileEl = document.getElementById('user-profile');
        const teamNameEl = document.getElementById('team-name');
        const teamMembersEl = document.getElementById('team-members');
        const joinTeamContainer = document.getElementById('join-team-container');
        const joinTeamBtn = document.getElementById('join-team-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const pageTitleEl = document.getElementById('page-title');
        const pageContentEl = document.getElementById('page-content');
        const iconLinks = document.querySelectorAll('.icon-item a');
        const backBtns = document.querySelectorAll('.back-btn');


        // --- FIREBASE INITIALIZATION ---
        let app, auth, db;
        try {
            if (firebaseConfig.apiKey.startsWith("##")) throw new Error("Firebase keys not replaced.");
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("CRITICAL: Firebase initialization failed.", e);
            appViews.loading.innerHTML = `<p class="text-red-400 text-lg">Error: Could not connect to services. Check console (F12).</p>`;
        }
        
        // --- VISUAL EFFECTS ---
        function createFlyingCrows(numberOfCrows) {
            const container = document.getElementById('flying-crows-container');
            if (!container) return;
            for (let i = 0; i < numberOfCrows; i++) {
                const crow = document.createElement('img');
                crow.src = 'images/flyingcrows.gif';
                crow.className = 'flying-crow';
                crow.style.top = `${Math.random() * 80}vh`;
                crow.style.animationDuration = `${10 + Math.random() * 10}s`;
                crow.style.animationDelay = `${Math.random() * 15}s`;
                container.appendChild(crow);
            }
        }

        // --- NAVIGATION & VIEW MANAGEMENT ---
        function showView(viewName) {
            Object.values(appViews).forEach(view => view.classList.add('hidden'));
            if (appViews[viewName]) {
                 appViews[viewName].classList.remove('hidden');
                 // Special case for landing page flex layout
                 if(viewName === 'landing') appViews[viewName].classList.add('flex');
            }
        }

        // --- CORE LOGIC ---
        function initializeAppLogic() {
            if (!auth) return;
            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                if (user) {
                    const discordToken = getDiscordToken();
                    if (discordToken) {
                        try {
                            discordUser = await fetchDiscordUser(discordToken);
                            await saveUserToFirestore(user.uid, discordUser);
                            // User is logged in, but we still show the landing page by default
                            renderAuthButtons();
                            loadTeamData();
                        } catch (error) {
                            console.error("Error with Discord user:", error);
                            clearSession(true);
                        }
                    } else {
                        renderLoggedOutState();
                    }
                } else {
                    signInAnonymously(auth).catch(console.error);
                }
            });
        }
        
        function handleLogin() {
            if (DISCORD_CLIENT_ID.startsWith("##")) {
                alert("Discord Client ID not configured.");
                return;
            }
            const redirectUri = encodeURIComponent(window.location.origin + window.location.pathname);
            const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${redirectUri}&response_type=token&scope=identify`;
            window.location.href = authUrl;
        }

        function getDiscordToken() {
            const fragment = new URLSearchParams(window.location.hash.substring(1));
            const token = fragment.get('access_token');
            if (token) {
                localStorage.setItem('discord_token', token);
                window.history.replaceState({}, document.title, window.location.pathname + window.location.search);
                return token;
            }
            return localStorage.getItem('discord_token');
        }

        async function fetchDiscordUser(token) {
            const response = await fetch('https://discord.com/api/users/@me', {
                headers: { authorization: `Bearer ${token}` },
            });
            if (!response.ok) {
                if (response.status === 401) throw new Error('Invalid Discord token.');
                throw new Error(`Discord API error: ${response.statusText}`);
            }
            return await response.json();
        }

        async function saveUserToFirestore(firebaseUid, dUser) {
            const userRef = doc(db, 'users', firebaseUid);
            const userData = {
                discordId: dUser.id,
                username: dUser.username,
                avatar: dUser.avatar,
                lastLogin: new Date()
            };
            await setDoc(userRef, userData, { merge: true });
        }

        async function loadTeamData() {
            const teamRef = doc(db, 'teams', TEAM_ID);
            const teamSnap = await getDoc(teamRef);

            if (!teamSnap.exists()) {
                console.error("Team document does not exist!");
                teamNameEl.textContent = "Team Not Found";
                teamMembersEl.innerHTML = `<p class="text-center text-red-400 col-span-full">The team data could not be loaded. Please contact an administrator.</p>`;
                return;
            }
            
            const teamData = teamSnap.data();
            renderTeamInfo(teamData);
            
            if (discordUser) {
                renderDashboardHeader(discordUser);
                const isMember = teamData.members.some(member => member.discordId === discordUser.id);
                joinTeamContainer.classList.toggle('hidden', isMember);
            }
        }
        
        async function handleJoinTeam() {
            if (!discordUser) return;
            joinTeamBtn.disabled = true;
            joinTeamBtn.textContent = "Joining...";
            const teamRef = doc(db, 'teams', TEAM_ID);
            const newMember = { discordId: discordUser.id, username: discordUser.username, avatar: discordUser.avatar };
            try {
                await updateDoc(teamRef, { members: arrayUnion(newMember) });
                loadTeamData();
            } catch (error) {
                console.error("Failed to join team:", error);
                alert("There was an error trying to join the team.");
                joinTeamBtn.disabled = false;
                joinTeamBtn.textContent = "Join Crow Syndicate";
            }
        }

        function clearSession(isError = false) {
            localStorage.removeItem('discord_token');
            discordUser = null;
            if (!isError) {
                window.location.href = window.location.pathname + window.location.search;
            } else {
                 renderLoggedOutState();
            }
        }
        
        // --- UI RENDERING ---
        function renderAuthButtons() {
            if (discordUser) {
                const avatarUrl = discordUser.avatar ? `https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png` : 'https://cdn.discordapp.com/embed/avatars/0.png';
                authButtonsContainer.innerHTML = `
                    <div class="flex items-center justify-center">
                        <img src="${avatarUrl}" class="w-10 h-10 rounded-full mr-4">
                        <span class="font-semibold">${discordUser.username}</span>
                    </div>
                `;
            } else {
                 authButtonsContainer.innerHTML = `
                    <button id="login-btn" class="discord-btn text-white font-bold py-3 px-6 rounded-lg inline-flex items-center text-lg">
                        <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 128 96"><path d="M107.7,8.3C100.2,3,90.5,0,79.2,0C65.2,0,52.3,3.9,41.2,10.8l-2.8,1.9C35.9,14.6,33,16,30,17.3c-0.1,0-0.1-0.1-0.2-0.1 C29.4,17,28.9,16.8,28.5,16.6c-0.8-0.5-1.5-1.2-2-1.9c-0.3-0.5-0.6-1-0.8-1.6C24,10.2,23.6,7.4,25,4.9c0.1-0.2,0.1-0.3,0.2-0.5 c0.5-1.2,1.2-2.3,2.2-3.3C28.1,0.4,29,0.1,29.9,0c0.1,0,0.2,0,0.3,0c0.2,0,0.3,0,0.5,0.1c0.3,0.1,0.6,0.2,0.8,0.4 c1,0.5,1.8,1.3,2.5,2.2c4.2,5.7,6.8,12.2,7.4,19.2c-1.1-0.4-2.1-0.8-3.2-1.2c-1.3-0.5-2.6-1-3.9-1.5c-0.1,0-0.2-0.1-0.2-0.1 c-0.1,0-0.2-0.1-0.3-0.1c-0.4-0.2-0.8-0.3-1.2-0.5c-0.2-0.1-0.5-0.2-0.7-0.3c-2.3-0.9-4.7-1.5-7.2-1.8c-2.3-0.3-4.7-0.2-7,0.3 c-3.5,0.7-6.9,2.1-9.9,4.2c-0.1,0.1-0.2,0.1-0.2,0.2c-0.1,0.1-0.2,0.1-0.3,0.2c-3.5,2.4-6.4,5.4-8.6,8.8c-2.4,3.7-4,7.8-4.7,12.1 c-0.7,4.3-0.6,8.6,0.3,12.8c0.1,0.5,0.2,1,0.3,1.5c0,0.1,0.1,0.2,0.1,0.3c0,0.1,0.1,0.2,0.1,0.2c0.1,0.2,0.2,0.5,0.3,0.7 c0.1,0.2,0.3,0.5,0.5,0.7c0.4,0.6,0.9,1.1,1.5,1.5c1.4,1,3.1,1.5,4.8,1.5c0.2,0,0.3,0,0.5,0c1.7-0.1,3.4-0.7,4.8-1.7 c2.4-1.7,4.2-4.1,5.1-6.9c-0.2,0.1-0.5,0.2-0.7,0.3c-2,0.8-4.1,1.4-6.2,1.8c-2.7,0.5-5.4,0.5-8.1-0.1c-0.1,0-0.2,0-0.2-0.1 c-0.1,0-0.2,0-0.3-0.1c-0.4-0.1-0.8-0.2-1.2-0.4c-0.1-0.1-0.3-0.1-0.4-0.2c-0.1,0-0.1-0.1-0.2-0.1c-0.1,0-0.1,0-0.2-0.1 c-0.4-0.2-0.8-0.5-1.2-0.8c-0.1-0.1-0.1-0.1-0.2-0.2c-0.5-0.4-1-0.8-1.5-1.3c-0.9-1-1.6-2-2.2-3.2c-0.6-1.1-1.1-2.3-1.5-3.5 c-0.4-1.2-0.6-2.5-0.8-3.7c-0.2-1.3-0.2-2.6-0.2-3.9c0-2.5,0.5-5,1.4-7.3c2-5.3,5.5-9.8,10.2-12.8c4.8-3.1,10.3-4.6,16-4.6 c2.5,0,5,0.3,7.4,0.8c2.4,0.5,4.7,1.4,6.8,2.5c2.1,1.2,4.1,2.6,5.8,4.3c5.4,5,8.1,11.7,8.1,19.2c0,3.2-0.6,6.4-1.7,9.4 c-0.1,0.3-0.2,0.5-0.3,0.8c-0.1,0.2-0.2,0.5-0.2,0.7c-0.1,0.2-0.2,0.3-0.2,0.5c-0.1,0.2-0.1,0.5-0.1,0.7c-0.1,0.4-0.1,0.8-0.1,1.2 c0,0.2,0,0.5,0.1,0.7c0,0.1,0,0.2,0.1,0.3c0.1,0.4,0.2,0.8,0.4,1.2c0.2,0.4,0.5,0.8,0.8,1.1c0.1,0.1,0.1,0.2,0.2,0.2 c0.6,0.6,1.2,1.1,2,1.5c1.5,0.8,3.2,1.2,5,1.2c1.8,0,3.5-0.5,5-1.4c0.1,0,0.1-0.1,0.2-0.1c1.4-0.9,2.5-2,3.3-3.4 c0.8-1.4,1.3-2.9,1.3-4.5c0-1.6-0.4-3.2-1.2-4.6c-0.1-0.1-0.1-0.2-0.2-0.2c-0.1-0.2-0.2-0.3-0.3-0.5c-0.1-0.1-0.1-0.2-0.2-0.3 c-0.1-0.2-0.2-0.3-0.3-0.5c-0.6-1.2-1.5-2.3-2.5-3.2c-1.1-0.9-2.3-1.7-3.6-2.2c-1.2-0.5-2.5-0.8-3.8-0.8c-0.3,0-0.5,0-0.8,0 c-0.2,0-0.3,0-0.5,0c-0.1,0-0.3,0-0.4,0c-0.1,0-0.2,0-0.3,0.1c-0.4,0.1-0.8,0.2-1.2,0.3c-0.4,0.2-0.8,0.4-1.2,0.6 c-0.4,0.2-0.8,0.5-1.1,0.8c-0.1,0.1-0.2,0.2-0.2,0.2c-0.1,0.1-0.2,0.2-0.2,0.2c-0.4,0.3-0.7,0.7-1,1.1c-0.3,0.4-0.6,0.9-0.8,1.4 c-0.2,0.5-0.4,1.1-0.5,1.7c-0.1,0.6-0.2,1.2-0.2,1.8c0,0.3,0,0.6,0.1,0.9c0,0.1,0,0.2,0.1,0.3c0.1,0.5,0.2,1,0.4,1.5 c0.2,0.5,0.5,0.9,0.8,1.3c0.1,0.1,0.1,0.2,0.2,0.2c0.1,0.1,0.2,0.2,0.3,0.3c0.1,0.1,0.2,0.2,0.3,0.3c1,0.8,2,1.4,3.1,1.8 c1.1,0.4,2.2,0.6,3.3,0.6c1.1,0,2.3-0.2,3.3-0.5c2.1-0.7,4-1.9,5.5-3.3c0.1-0.1,0.1-0.2,0.2-0.2c0.1-0.1,0.2-0.2,0.2-0.3 c1.5-1.4,2.6-3.2,3.3-5.1c0.7-1.9,1-3.9,1-6c0-6.2-2.2-11.9-6.3-16.4C116.7,15.7,112.5,11.5,107.7,8.3z"/></svg>
                        Login with Discord
                    </button>`;
                 document.getElementById('login-btn').addEventListener('click', handleLogin);
            }
        }
        
        function renderLoggedOutState() {
            showView('landing');
            renderAuthButtons();
        }

        function renderDashboardHeader(dUser) {
            const avatarUrl = dUser.avatar 
                ? `https://cdn.discordapp.com/avatars/${dUser.id}/${dUser.avatar}.png`
                : 'https://cdn.discordapp.com/embed/avatars/0.png';

            userProfileEl.innerHTML = `
                <img src="${avatarUrl}" alt="${dUser.username}'s avatar" class="w-12 h-12 rounded-full mr-4 border-2 border-gray-600">
                <div>
                    <p class="font-semibold text-lg">${dUser.username}</p>
                </div>`;
        }
        
        function renderTeamInfo(teamData) {
            teamNameEl.textContent = teamData.name;
            if (teamData.members && teamData.members.length > 0) {
                 teamMembersEl.innerHTML = teamData.members.map(member => {
                    const avatarUrl = member.avatar 
                        ? `https://cdn.discordapp.com/avatars/${member.discordId}/${member.avatar}.png`
                        : 'https://cdn.discordapp.com/embed/avatars/0.png';
                    return `
                        <div class="bg-gray-700 p-3 rounded-lg flex items-center shadow-md">
                            <img src="${avatarUrl}" class="w-10 h-10 rounded-full mr-3">
                            <span class="font-medium">${member.username}</span>
                        </div>
                    `;
                 }).join('');
            } else {
                teamMembersEl.innerHTML = `<p class="text-center text-gray-400 col-span-full">This team has no members yet.</p>`;
            }
        }

        // --- EVENT LISTENERS ---
        logoutBtn.addEventListener('click', () => clearSession(false));
        joinTeamBtn.addEventListener('click', handleJoinTeam);
        
        iconLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.dataset.page;
                const pageTitle = link.dataset.tooltip;

                if (page === 'members') {
                    if (discordUser) {
                        showView('dashboard');
                    } else {
                        // Prompt login if trying to access members page while logged out
                        handleLogin();
                    }
                } else {
                    pageTitleEl.textContent = pageTitle;
                    // You can add custom content for each page here later
                    pageContentEl.innerHTML = `<p>Content for the ${pageTitle} section is coming soon!</p>`;
                    showView('page');
                }
            });
        });

        backBtns.forEach(btn => {
            btn.addEventListener('click', () => showView('landing'));
        });

        // --- APP START ---
        showView('loading');
        createFlyingCrows(5); // Add 5 flying crows to the scene
        initializeAppLogic();
    </script>
</body>
</html>

